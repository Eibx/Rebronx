<template>
	<div class="map" v-on:mousedown="mousedown" v-on:mouseup="mouseup" v-on:mousemove="mousemove" v-on:wheel="mousewheel">
		<svg xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#" xmlns="http://www.w3.org/2000/svg" xmlns:osb="http://www.openswatchbook.org/uri/2009/osb" height="1e3" width="1e3" version="1.1" xmlns:cc="http://creativecommons.org/ns#" viewBox="0 0 1000 1000" xmlns:dc="http://purl.org/dc/elements/1.1/">
			<metadata id="metadata7">
				<rdf:RDF>
					<cc:Work rdf:about="">
						<dc:format>image/svg+xml</dc:format>
						<dc:type rdf:resource="http://purl.org/dc/dcmitype/StillImage" />
						<dc:title/>
					</cc:Work>
				</rdf:RDF>
			</metadata>
			<g id="layer3" fill-rule="evenodd">
				<path id="rect8078" style="color-rendering:auto;color:#000000;isolation:auto;mix-blend-mode:normal;shape-rendering:auto;solid-color:#000000;image-rendering:auto" d="m-60-60h1120v1100h-1120z" fill="#43e5e2" />
				<path id="path8084" d="m-60 980 1e3 20 60-60l-20-700-1040-300z" fill="#1fdcd8" />
			</g>
			<g id="layer2" fill-rule="evenodd">
				<path id="path8073" d="m760 40 140 60 80 140v680l-60 60h-600-380v-1040h640v60z" fill="#00c800" />
				<path id="path8075" d="m980 240-20 680-40 40-920 20h920l60-60z" fill="#bd8629" />
			</g>
			<g id="layer4" fill-rule="evenodd" fill="#767676">
				<path id="path9592" d="m0 200v740h520v-41.664l-339.86-50.98-130.14-260.28v-387.08h-50z" />
				<path id="path10037" d="m0-20h560v100h-340l-120 40-20 60h-80z" />
				<path id="path8096" d="m340 80h220l160 40 100 60 60 80 20 100v100h-300l-120-100h-140z" />
			</g>
			<g id="layer8">
				<path id="path5962" d="m365 335h40v-80h-40z" fill-rule="evenodd" stroke="#595959" stroke-width="1px" fill="#a9a9a9" />
				<g fill-rule="evenodd" stroke="#595959" stroke-width="1px" fill="#a9a9a9">
					<path id="path5964" style="color-rendering:auto;color:#000000;isolation:auto;mix-blend-mode:normal;shape-rendering:auto;solid-color:#000000;image-rendering:auto" d="m365 255h40l30-30h-70z" />
					<path id="path5980" style="color-rendering:auto;color:#000000;isolation:auto;mix-blend-mode:normal;shape-rendering:auto;solid-color:#000000;image-rendering:auto" d="m395 225h40l20-20h15v-25h-75z" />
					<path id="path5982" style="color-rendering:auto;color:#000000;isolation:auto;mix-blend-mode:normal;shape-rendering:auto;solid-color:#000000;image-rendering:auto" d="m365 180v15h30v-15z" />
					<path id="path5984" style="color-rendering:auto;color:#000000;isolation:auto;mix-blend-mode:normal;shape-rendering:auto;solid-color:#000000;image-rendering:auto" d="m365 195v30h30v-30z" />
					<path id="path5986" style="color-rendering:auto;color:#000000;isolation:auto;mix-blend-mode:normal;shape-rendering:auto;solid-color:#000000;image-rendering:auto" d="m470 205h25l5-10 10-5 10 5 5 10h30v-40h-85z" />
					<path id="path5993" style="color-rendering:auto;color:#000000;isolation:auto;mix-blend-mode:normal;shape-rendering:auto;solid-color:#000000;image-rendering:auto" d="m365 180h45v-25h-45z" />
					<path id="path5995" style="color-rendering:auto;color:#000000;isolation:auto;mix-blend-mode:normal;shape-rendering:auto;solid-color:#000000;image-rendering:auto" d="m365 155v-30l10-10h85v20h-75v20z" />
					<path id="path6002" style="color-rendering:auto;color:#000000;isolation:auto;mix-blend-mode:normal;shape-rendering:auto;solid-color:#000000;image-rendering:auto" d="m435 335v-70l30-30h55v30h-40l-15 15v55z" />
					<path id="path6009" style="color-rendering:auto;color:#000000;isolation:auto;mix-blend-mode:normal;shape-rendering:auto;solid-color:#000000;image-rendering:auto" d="m465 335h25l35 30v-65h-60z" />
					<path id="path6020" style="color-rendering:auto;color:#000000;isolation:auto;mix-blend-mode:normal;shape-rendering:auto;solid-color:#000000;image-rendering:auto" d="m520 275h35v-40h-35v40" />
					<path id="path6027" style="color-rendering:auto;color:#000000;isolation:auto;mix-blend-mode:normal;shape-rendering:auto;solid-color:#000000;image-rendering:auto" d="m555 205h110v-20h-110z" />
					<path id="path6029" style="color-rendering:auto;color:#000000;isolation:auto;mix-blend-mode:normal;shape-rendering:auto;solid-color:#000000;image-rendering:auto" d="m665 205 20 20h30v-40h-50z" />
					<path id="path6031" style="color-rendering:auto;color:#000000;isolation:auto;mix-blend-mode:normal;shape-rendering:auto;solid-color:#000000;image-rendering:auto" d="m685 225 30 30h45v-30z" />
					<path id="path6033" style="color-rendering:auto;color:#000000;isolation:auto;mix-blend-mode:normal;shape-rendering:auto;solid-color:#000000;image-rendering:auto" d="m715 255v55h25v-55z" />
					<path id="path6035" style="color-rendering:auto;color:#000000;isolation:auto;mix-blend-mode:normal;shape-rendering:auto;solid-color:#000000;image-rendering:auto" d="m715 310v25h45v-25z" />
					<path id="path6039" style="color-rendering:auto;color:#000000;isolation:auto;mix-blend-mode:normal;shape-rendering:auto;solid-color:#000000;image-rendering:auto" d="m715 435h75v-20h-55v-80h-20z" />
					<path id="path6046" style="color-rendering:auto;color:#000000;isolation:auto;mix-blend-mode:normal;shape-rendering:auto;solid-color:#000000;image-rendering:auto" d="m790 435h25v-40h-25z" />
					<path id="path6048" style="color-rendering:auto;color:#000000;isolation:auto;mix-blend-mode:normal;shape-rendering:auto;solid-color:#000000;image-rendering:auto" d="m815 435h25v-40h-25z" />
					<path id="path6050" style="color-rendering:auto;color:#000000;isolation:auto;mix-blend-mode:normal;shape-rendering:auto;solid-color:#000000;image-rendering:auto" d="m840 435h25v-70l-10-60h-15z" />
					<path id="path6052" style="color-rendering:auto;color:#000000;isolation:auto;mix-blend-mode:normal;shape-rendering:auto;solid-color:#000000;image-rendering:auto" d="m855 305-5-30h-35v30z" />
					<path id="path6054" style="color-rendering:auto;color:#000000;isolation:auto;mix-blend-mode:normal;shape-rendering:auto;solid-color:#000000;image-rendering:auto" d="m850 275-55-70h-25l55 70z" />
					<path id="path6056" style="color-rendering:auto;color:#000000;isolation:auto;mix-blend-mode:normal;shape-rendering:auto;solid-color:#000000;image-rendering:auto" d="m760 185 35 20h-55v-20z" />
					<path id="path6058" style="color-rendering:auto;color:#000000;isolation:auto;mix-blend-mode:normal;shape-rendering:auto;solid-color:#000000;image-rendering:auto" d="m700 150v35h-40v-45z" />
					<path id="path6060" style="color-rendering:auto;color:#000000;isolation:auto;mix-blend-mode:normal;shape-rendering:auto;solid-color:#000000;image-rendering:auto" d="m715 185h25v20h-25z" />
					<path id="path6067" style="color-rendering:auto;color:#000000;isolation:auto;mix-blend-mode:normal;shape-rendering:auto;solid-color:#000000;image-rendering:auto" d="m830 385h-65v-25h65z" />
					<path id="path6074" style="color-rendering:auto;color:#000000;isolation:auto;mix-blend-mode:normal;shape-rendering:auto;solid-color:#000000;image-rendering:auto" d="m740 305h100v5h-100z" />
					<path id="path6081" style="color-rendering:auto;color:#000000;isolation:auto;mix-blend-mode:normal;shape-rendering:auto;solid-color:#000000;image-rendering:auto" d="m660 140h-35v45h35z" />
					<path id="path6083" style="color-rendering:auto;color:#000000;isolation:auto;mix-blend-mode:normal;shape-rendering:auto;solid-color:#000000;image-rendering:auto" d="m625 135-25-5v55h25z" />
					<path id="path6085" style="color-rendering:auto;color:#000000;isolation:auto;mix-blend-mode:normal;shape-rendering:auto;solid-color:#000000;image-rendering:auto" d="m575 120 20 5v15h5v45h-45v-20-45h20z" />
					<path id="path6097" style="color-rendering:auto;color:#000000;isolation:auto;mix-blend-mode:normal;shape-rendering:auto;solid-color:#000000;image-rendering:auto" d="m460 115h95v25h-95z" />
					<path id="path6126" style="color-rendering:auto;color:#000000;isolation:auto;mix-blend-mode:normal;shape-rendering:auto;solid-color:#000000;image-rendering:auto" d="m525 365h15v-30h-15z" />
					<path id="path6128" style="color-rendering:auto;color:#000000;isolation:auto;mix-blend-mode:normal;shape-rendering:auto;solid-color:#000000;image-rendering:auto" d="m540 375 15 10v-30h-15z" />
					<path id="path6140" style="color-rendering:auto;color:#000000;isolation:auto;mix-blend-mode:normal;shape-rendering:auto;solid-color:#000000;image-rendering:auto" d="m555 385h45v-40h-45z" />
					<path id="path6147" style="color-rendering:auto;color:#000000;isolation:auto;mix-blend-mode:normal;shape-rendering:auto;solid-color:#000000;image-rendering:auto" d="m600 415v-70h30v90h-20l-10-10z" />
					<path id="path6156" style="color-rendering:auto;color:#000000;isolation:auto;mix-blend-mode:normal;shape-rendering:auto;solid-color:#000000;image-rendering:auto" d="m630 435h55v-55h-15v40h-40z" />
					<path id="path6163" style="color-rendering:auto;color:#000000;isolation:auto;mix-blend-mode:normal;shape-rendering:auto;solid-color:#000000;image-rendering:auto" d="m660 380h25v-45h-25z" />
					<path id="path6165" style="color-rendering:auto;color:#000000;isolation:auto;mix-blend-mode:normal;shape-rendering:auto;solid-color:#000000;image-rendering:auto" d="m660 330h25v-35h-25v35z" />
					<path id="path6104" style="color-rendering:auto;color:#000000;isolation:auto;mix-blend-mode:normal;shape-rendering:auto;solid-color:#000000;image-rendering:auto" d="m655 250 10 10v10h10l10 10v15h-130v-45z" />
					<path id="path6111" style="color-rendering:auto;color:#000000;isolation:auto;mix-blend-mode:normal;shape-rendering:auto;solid-color:#000000;image-rendering:auto" d="m560 245h5v-5h-5z" />
					<path id="path6113" style="color-rendering:auto;color:#000000;isolation:auto;mix-blend-mode:normal;shape-rendering:auto;solid-color:#000000;image-rendering:auto" d="m580 245h5v-5h-5v5z" />
					<path id="path6115" style="color-rendering:auto;color:#000000;isolation:auto;mix-blend-mode:normal;shape-rendering:auto;solid-color:#000000;image-rendering:auto" d="m600 245h5v-5h-5z" />
					<path id="path6117" style="color-rendering:auto;color:#000000;isolation:auto;mix-blend-mode:normal;shape-rendering:auto;solid-color:#000000;image-rendering:auto" d="m620 245h5v-5h-5z" />
					<path id="path6119" style="color-rendering:auto;color:#000000;isolation:auto;mix-blend-mode:normal;shape-rendering:auto;solid-color:#000000;image-rendering:auto" d="m640 245h5v-5h-5z" />
				</g>
				<path id="path8174-7" d="m270 110v45l-34.441 28.179-20.56 16.82" stroke="#a59771" stroke-width="4" fill="none" />
				<circle id="path4176" style="color-rendering:auto;color:#000000;isolation:auto;mix-blend-mode:normal;shape-rendering:auto;solid-color:#000000;image-rendering:auto" cx="215" fill-rule="evenodd" cy="200" r="25" fill="#6e6233" />
				<circle id="path4176-3" stroke-linejoin="round" style="color-rendering:auto;color:#000000;isolation:auto;mix-blend-mode:normal;shape-rendering:auto;solid-color:#000000;image-rendering:auto" cx="215" stroke-linecap="round" stroke="#a59771" cy="200" r="25" stroke-width=".5" fill="none" />
				<path id="path8174" d="m270 110v45l-55 45" stroke="#6e6233" stroke-width="3" fill="none" />
				<rect id="rect4214-6-2" style="color-rendering:auto;color:#000000;isolation:auto;mix-blend-mode:normal;shape-rendering:auto;solid-color:#000000;image-rendering:auto" fill-rule="evenodd" height="5" width="5" y="197.5" x="212.5" fill="#fff" />
				<g id="g4329" fill="#836539" transform="translate(-7.5,11.125)">
					<path id="path4293-9-1" style="color-rendering:auto;color:#000000;isolation:auto;mix-blend-mode:normal;shape-rendering:auto;solid-color:#000000;image-rendering:auto" d="m220 170v-2h5v2" fill-rule="evenodd" fill="#8e8e8e" />
				</g>
				<g fill="#8e8e8e">
					<g id="g4329-2" style="color-rendering:auto;color:#000000;isolation:auto;mix-blend-mode:normal;shape-rendering:auto;solid-color:#000000;image-rendering:auto" fill-rule="evenodd" transform="matrix(0,-1,1,0,26.125,422.5)">
						<path id="path4293-9-1-7" style="color-rendering:auto;color:#000000;isolation:auto;mix-blend-mode:normal;shape-rendering:auto;solid-color:#000000;image-rendering:auto" d="m220 170v-2h5v2" fill-rule="evenodd" fill="#8e8e8e" />
					</g>
					<g id="g4329-2-0" style="color-rendering:auto;color:#000000;isolation:auto;mix-blend-mode:normal;shape-rendering:auto;solid-color:#000000;image-rendering:auto" fill-rule="evenodd" transform="matrix(-1 0 0 -1 437.5 388.88)">
						<path id="path4293-9-1-7-9" style="color-rendering:auto;color:#000000;isolation:auto;mix-blend-mode:normal;shape-rendering:auto;solid-color:#000000;image-rendering:auto" d="m220 170v-2h5v2" fill-rule="evenodd" fill="#8e8e8e" />
					</g>
					<g id="g4329-2-0-3" transform="matrix(0 1 -1 0 403.88 -22.5)">
						<path id="path4293-9-1-7-9-6" d="m220 170v-2h5v2" fill-rule="evenodd" fill="#8e8e8e" />
					</g>
				</g>
			</g>
			<g id="layer5" stroke="#595959" fill="none">
				<path id="path8070-7" d="m900 860-300 20-400-60-120-240v-398l20-60 60-22 60-20h340l160 40 45.012 27.907 54.99 34.09 60 78 20 100z" stroke-width="60" />
				<path id="path9903" d="m340 80v760" stroke-width="40" />
				<path id="path10039" d="m80 240 120 120h280l120 100h300" stroke-width="40" />
				<path id="path10105" style="color-rendering:auto;color:#000000;isolation:auto;mix-blend-mode:normal;shape-rendering:auto;solid-color:#000000;image-rendering:auto" d="m420 360v-100l40-40h200l40 40v200" stroke-width="20" />
			</g>
			<g id="layer1" transform="translate(0 -52.362)" fill="none">
				<g stroke="#323232">
					<path id="path8070" d="m900 912.36-300 20-400-60-120-240v-398l19.171-57.514 0.82857-2.4857 60-22 60-20h340c53.333 13.333 106.67 26.667 160 40l100 62 60 78 20 100z" stroke-width="40" />
					<path id="path9903-3" d="m340 132.36v760" stroke-width="20" />
					<path id="path10039-6" d="m80 292.36 120 120h280l120 100h300" stroke-width="20" />
					<path id="path10105-3" style="color-rendering:auto;color:#000000;isolation:auto;mix-blend-mode:normal;shape-rendering:auto;solid-color:#000000;image-rendering:auto" d="m420 412.36v-100l40-40h200l40 40v200" stroke-width="10" />
				</g>
				<path id="path8172" stroke-linejoin="round" d="m125 222.36 5-15 95-35h30" stroke="#007d00" stroke-linecap="round" stroke-width="10" />
			</g>
			<g id="layer7">
				<template v-for="node in mapLines">
					<line v-bind:x1="node.sx * 10" v-bind:y1="node.sy * 10" v-bind:x2="node.ex * 10" v-bind:y2="node.ey * 10" stroke-width="2" stroke="#666" />
				</template>
				<template v-for="node in mapData">
					<rect class="map__node" height="6" width="6" v-bind:x="node.posX*10-3" v-bind:y="node.posY*10-3" v-bind:class="{ 'map__node-current': node.isCurrent }" v-on:click="move(node.id)" />
				</template>
			</g>
			<g id="layer6" display="none">
				<rect id="rect4229" style="color-rendering:auto;color:#000000;isolation:auto;mix-blend-mode:normal;shape-rendering:auto;solid-color:#000000;image-rendering:auto" display="inline" height="1e3" width="1e3" stroke="#ff0505" y="0" x="0" stroke-width="8" fill="none" />
			</g>
		</svg>
	
	</div>
</template>

<script>
export default {
	name: 'map',

	data() {
		return {
			mapData: [],
			mapLines: [],

			isDown: false,
			startX: 0,
			startY: 0,
			offsetX: 0,
			offsetY: 0,
			moveX: 0,
			moveY: 0,
			zoomW: 500,
		}
	},
	created() {
		var self = this;

		this.mapData = [
			{ id: 1, posX: 10, posY: 12, connections: [2, 6], isCurrent: false },
			{ id: 2, posX: 22, posY: 8, connections: [1, 3], isCurrent: false },
			{ id: 3, posX: 34, posY: 8, connections: [2, 4, 5], isCurrent: false },
			{ id: 4, posX: 56, posY: 8, connections: [3], isCurrent: false },
			{ id: 5, posX: 34, posY: 22, connections: [3, 10], isCurrent: false },

			{ id: 6, posX: 8, posY: 25, connections: [1, 7], isCurrent: false },
			{ id: 7, posX: 15, posY: 31, connections: [6, 8], isCurrent: false },
			{ id: 8, posX: 20, posY: 36, connections: [7, 9], isCurrent: false },
			{ id: 9, posX: 27, posY: 36, connections: [8, 10], isCurrent: false },
			{ id: 10, posX: 34, posY: 36, connections: [9, 5], isCurrent: false }
		];

		var s = this.mapData[1];

		for (var j = 0; j < s.connections.length; j++) {
			var	e = getPointPosition(this.mapData, s.connections[j]);

			if (e) {
				this.mapLines.push({ sx: s.posX, sy: s.posY, ex: e.x, ey: e.y });
			}
		}

		function getPointPosition(mapData, id) {
			for (var i = 0; i < mapData.length; i++) {
				var p = mapData[i];
				if (p.id == id) {
					return { x: p.posX, y: p.posY };
				}
			}
		}

		function setCurrentPosition(position) {
			for (var i = 0; i < self.mapData.length; i++) {
				self.mapData[i].isCurrent = (self.mapData[i].id == position);
			}
		}

		dataService.subscribe('player', function(type, data) {
			if (type == "position") {
				setCurrentPosition(data.position);
			}
		});
		dataService.subscribe('join', function(type, data) {
			if (type == "join") {
				setCurrentPosition(data.position);
			}
		});
	},
	methods: {
		move: function(id) {
			dataService.send('movement', 'move', { position: id });
		},
		mousedown: function (evt) {
			evt.preventDefault();
			this.startX = evt.clientX;
			this.startY = evt.clientY;
			this.moveX = 0;
			this.moveY = 0;
			this.isDown = true;
		},
		mouseup: function (evt) {
			evt.preventDefault();
			this.offsetX += evt.clientX - this.startX;
			this.offsetY += evt.clientY - this.startY;
			this.moveX = 0;
			this.moveY = 0;
			this.isDown = false;
		},
		mousemove: function (evt) {
			evt.preventDefault();
			if (this.isDown) {
				this.moveX = evt.clientX - this.startX;
				this.moveY = evt.clientY - this.startY;
			}
		},
		mousewheel: function (evt) {
			evt.preventDefault();
			var direction = 0;
			if (evt.deltaY < 0) {
				direction = 1;
			} else {
				direction = -1;
			}

			var zoomAmount = this.zoomW * 0.10;

			var perX = (evt.clientX - this.offsetX) / this.zoomW;
			var perY = (evt.clientY - this.offsetY) / this.zoomW;

			this.zoomW += (zoomAmount * direction * (1 - perY)) + ((zoomAmount * direction) * (1 - perX));
			this.offsetX -= (zoomAmount * direction) * perX;
			this.offsetY -= (zoomAmount * direction) * perY;
		}
	}
}
</script>

<style scoped>
.map {
	user-select: none;
	position: absolute;
	width: 100%;
	height: 100%;
	left: 0;
	top: 0;
	z-index: 1;
}

.map img {
	position: absolute;
}

.map__node:hover {
	fill:yellowgreen;
}
.map__node-current {
	fill:red;
}
</style>
